---
import '../styles/global.css';
// Component Imports
import Button from '../components/Button.astro';
import ReactCounter from '../components/ReactCounter';
import BookmarkCard from '../components/BookmarkCard.astro';
import SearchBar from '../components/SearchBar';
import TagChips from '../components/TagChips';

// Full Astro Component Syntax:
// https://docs.astro.build/basics/astro-components/
const url = new URL(Astro.request.url);
const q = url.searchParams.get('q') || '';
const tag = url.searchParams.get('tag') || '';
const domain = url.searchParams.get('domain') || '';
const sort = url.searchParams.get('sort') || 'added_at';
const order = url.searchParams.get('order') || 'desc';
const page = Number(url.searchParams.get('page') || 1);
const pageSize = Number(url.searchParams.get('pageSize') || 24);


// Server-side initial data
const apiUrl = new URL('/api/gmail/links', Astro.url.origin);
apiUrl.searchParams.set('page', String(page));
apiUrl.searchParams.set('pageSize', String(pageSize));
if (q) apiUrl.searchParams.set('q', q);
if (tag) apiUrl.searchParams.set('tag', tag);
if (domain) apiUrl.searchParams.set('domain', domain);
apiUrl.searchParams.set('sort', sort);
apiUrl.searchParams.set('order', order);


// const initial = await fetch(apiUrl).then(r=>r.json());
//const allTags: string[] = Array.from(new Set(initial.items.flatMap((i:any)=>i.tags||[]))).sort();
//const allDomains: string[] = Array.from(new Set(initial.items.map((i:any)=>i.domain))).sort();
---

<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="generator" content={Astro.generator} />
		<title>Astro + TailwindCSS</title>
	</head>

    <body class="bg-gray-50 min-h-screen">
    <main class="max-w-6xl mx-auto p-4">
        <header class="flex justify-between items-center mb-4">
            <h1 class="text-2xl font-bold">Mes Bookmarks Gmail</h1>
            <a href="/api/auth/google" class="text-blue-600 underline">Connecter Google</a>
        </header>


        <div class="flex gap-4 mb-4">
            <SearchBar />
            <TagChips />
        </div>


        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">

        </div>
    </main>
    </body>
</html>
