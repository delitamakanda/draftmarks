---
import '../styles/global.css';
import Button from "../components/Button.astro";
import { getSessionCookie} from "../lib/oauth.ts";
import { db } from '../lib/db.ts';
export const prerender = false;
const req = Astro.request;
const headers = req.headers;

// verify session cookie
const sessionId = getSessionCookie(headers);
let isAuthenticated = false;

if (sessionId) {
    const token = await db.getToken(sessionId);
    if (token && token.expiresAt && Number(token.expiresAt) > Date.now()) {
        isAuthenticated = true;
    }
}

interface Settings {
    id: string;
    title: string;
    description: string;
    href: string;
}

const settings: Settings[] = [
    {
        id: "legal-page",
        title: "Legal Notice",
        description: "Legal Notice of our site",
        href: "/mentions-legales"
    },
    {
        id: "privacy-policy-page",
        title: "Privacy Policy",
        description: "Privacy Policy of our site",
        href: "/politique-de-confidentialite"
    },
    {
        id: "terms-of-service-page",
        title: "Terms of Service",
        description: "Terms of Service of our site",
        href: "/conditions-d-utilisation"
    },
    {
        id: "contact-page",
        title: "Contact us",
        description: "Contact us for any questions or concerns. Contact us via our email or social media platforms.",
        href: "/contact"
    },
    {
        id: "accounts-page",
        title: "Settings",
        description: "Settings of your account",
        href: "/parametres-de-compte"
    }
];
---
<html lang="fr">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width" />
        <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
        <meta name="generator" content={Astro.generator} />
        <title>Astro + TailwindCSS</title>
    </head>
    <body class="bg-white text-gray-900">
    <main class="max-w-7xl mx-auto p-4">
        <header class="flex flex-wrap items-center justify-between gap-3 mb-6">
            <h1 class="text-2xl font-bold">DraftMarks</h1>
            <a href="/" class="text-sm underline">Home</a>
        </header>
        {!isAuthenticated ? (
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-6 mb-8">
                    <p class="text-blue-900 mb-4">
                        You must be logged in to access your account settings.
                    </p>
                    <a href="/api/oauth/google" class="inline-block bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                        Sign in with Google
                    </a>
                </div>
        ) : null}
        <div class="max-w-2xl mx-auto">
            <div class="bg-white rounded-lg border border-gray-200 overflow-hidden">
                {settings.map((setting, index) => (
                        <a
                                href={setting.href}
                                class={`block p-4 hover:bg-gray-50 transition-colors ${index !== settings.length - 1 ? 'border-b border-gray-200' : ''}`}
                        >
                            <div class="flex items-center justify-between">
                                <div class="flex-1">
                                    <h2 class="text-base font-medium text-gray-900">{setting.title}</h2>
                                    <p class="text-gray-500 text-sm mt-0.5">{setting.description}</p>
                                </div>
                                <span class="text-gray-400 ml-4">â€º</span>
                            </div>
                        </a>
                ))}
            </div>
        </div>
    </main>
    </body>
</html>